#!/bin/bash

yadm remote set-url origin git@github.com:cohenchris/dotfiles.git
yadm decrypt

################################################################################
#                        INSTALL PERSONAL PACKAGES                             #
################################################################################
# Add a PacMan visual + enable parallel downloads
sudo sed '/ParallelDownloads/s/^#/ILoveCandy\n/g' -i /etc/pacman.conf

paru -Syu --noconfirm
filename="packages"
cd ~/.local/backup/

# install all personal packages
total_pkgs=$(grep '^[a-zA-Z0-9]' packages | wc -l)
curr_pkg=0

while read pkg_name
do
  # Omit lines that are blank or commented out
  if [[ -n $pkg_name ]] && ! [[ $pkg_name =~ ^#.* ]]; then

    pkg_name=$(echo $pkg_name | cut -d "#" -f 1)

    curr_pkg=$((curr_pkg+1))
    echo "Installing package $curr_pkg/$total_pkgs - $pkg_name"
    paru -S --noconfirm $pkg_name > /dev/null 2>&1

    if [[ $? -ne 0 ]]
    then
      echo $pkg_name >> ~/failed_installs.txt
    fi

  fi
done < $filename
cd

################################################################################
#                             SHELL + TERMINAL                                 #
################################################################################
sudo mkdir /etc/zsh
echo "ZDOTDIR=$HOME/.config/shell" > zshenv
sudo mv zshenv /etc/zsh/

# Change default shell to zsh
chsh -s $(which zsh)
source .config/shell/.zprofile

# Install zsh plugins
mkdir -p ~/.local/share/zsh/plugins
cd ~/.local/share/zsh/plugins
git clone https://github.com/zdharma-continuum/fast-syntax-highlighting
git clone https://github.com/zsh-users/zsh-completions
git clone https://github.com/zsh-users/zsh-autosuggestions
git clone https://github.com/zsh-users/zsh-history-substring-search

# Personal suckless terminal config
cd
git clone git@github.com:cohenchris/st
cd st
sudo make clean install
cd ../
rm -rf st/

################################################################################
#                                   MISC                                       #
################################################################################
# Download wallpapers
git clone git@github.com:cohenchris/wallpapers ~/.local/wallpapers

# Delete unnecessary XDG folders
cd
rm -rf Desktop Documents Music Pictures Public Templates Videos

# npm config
sudo mkdir /usr/etc
echo "prefix=${XDG_DATA_HOME}/npm
cache=${XDG_CACHE_HOME}/npm
init-module=${XDG_CONFIG_HOME}/npm/config/npm-init.js" > npmrc
sudo mv npmrc /usr/etc/

# Replace notmuch config database path with whoever the $USER is
sed -i "s/phrog/$USER/g" $XDG_CONFIG_HOME/notmuch/config





sudo reboot
